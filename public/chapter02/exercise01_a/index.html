<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="de">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>2. Prozedurales Gelände - Computergrafik MIB</title>

    
    <meta name="description" content="Online-Material zur Veranstaltung Computergrafik MIB.">
    
    <link rel="canonical" href="https://simonstorlschulke.github.io/cg-mib-2/chapter02/exercise01_a/">
    

    <meta property="og:url" content="https://simonstorlschulke.github.io/cg-mib-2/chapter02/exercise01_a/">
    <meta property="og:title" content="Computergrafik MIB">
    <meta property="og:image" content="https://simonstorlschulke.github.io/cg-mib-2/images/lecture_logo_dvmp.png">
    <meta name="apple-mobile-web-app-title" content="Computergrafik MIB">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://simonstorlschulke.github.io/cg-mib-2/images/lecture_icon.png">
    <link rel="icon" type="image/x-icon" href="https://simonstorlschulke.github.io/cg-mib-2/images/lecture_icon.png">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://simonstorlschulke.github.io/cg-mib-2/fonts/icon.eot?52m981');
        src: url('https://simonstorlschulke.github.io/cg-mib-2/fonts/icon.eot#iefix52m981')
               format('embedded-opentype'),
             url('https://simonstorlschulke.github.io/cg-mib-2/fonts/icon.woff?52m981')
               format('woff'),
             url('https://simonstorlschulke.github.io/cg-mib-2/fonts/icon.ttf?52m981')
               format('truetype'),
             url('https://simonstorlschulke.github.io/cg-mib-2/fonts/icon.svg?52m981#icon')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://simonstorlschulke.github.io/cg-mib-2/stylesheets/application.css">
    <link rel="stylesheet" href="https://simonstorlschulke.github.io/cg-mib-2/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://simonstorlschulke.github.io/cg-mib-2/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://simonstorlschulke.github.io/cg-mib-2/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="https://simonstorlschulke.github.io/cg-mib-2/stylesheets/custom.css">
    
    <script src="https://simonstorlschulke.github.io/cg-mib-2/javascripts/modernizr.js"></script>


  </head>
  <body class="palette-primary-indigo palette-accent-teal">




<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        2. Prozedurales Gelände
      </div>
    </div>

    

    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://simonstorlschulke.github.io/cg-mib-2//general" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://simonstorlschulke.github.io/cg-mib-2/images/lecture_logo_dvmp.png">
        </div>
      
      <div class="name">
        <strong>Computergrafik MIB </strong>
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          




<li>
  
    <span class="section">Allgemeines</span>
    <ul>
      
        
        



<a  title="Codeschnipsel" href="https://simonstorlschulke.github.io/cg-mib-2/course-scripts/">
	
	Codeschnipsel
</a>



      
        
        



<a  title="Kursinfo" href="https://simonstorlschulke.github.io/cg-mib-2/general/">
	
	Kursinfo
</a>



      
        
        



<a  title="Links &amp; Literatur" href="https://simonstorlschulke.github.io/cg-mib-2/links/">
	
	Links &amp; Literatur
</a>



      
    </ul>
  
</li>



<li>
  
    <span class="section">Kapitel</span>
    <ul>
      
        
        



<a  title="1. Datenstrukturen in 3D &amp; Godot Basics" href="https://simonstorlschulke.github.io/cg-mib-2/chapter01/exercise01_a/">
	
	1. Datenstrukturen in 3D &amp; Godot Basics
</a>



      
        
        



<a class="current" title="1. Prozedurales Gelände" href="https://simonstorlschulke.github.io/cg-mib-2/chapter02/exercise01_a/">
	
	1. Prozedurales Gelände
</a>


<ul id="scrollspy">
</ul>


      
    </ul>
  
</li>


        </ul>
        

        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>2. Prozedurales Gelände </h1>

			<p><strong>Im letzten Kapitel haben wir damit begonnen, een Script zu schreiben, welches uns eine prozedurale Landschaft generiert. Damit wollen wir nun weitermachen.</strong></p>
<h2 id="21-normalen-berechnen">2.1 Normalen berechnen</h2>
<p>Beim letzten mal haben wir mit unserem Code sehr kleinteilig direkt auf den Meshdaten gearbeitet. Dazu nutzten wir Godots ArrayMesh-Datentyp. Godot bietet uns jedoch auch ausgereiftere Tools um mit Meshes zu arbeiten. Generell ist es ratsam bereits in einer Engine existierende Funktionalität nicht neu zu erfinden. Deswegen bauen wir unseren Code nun zunächst so um, dass er Godots <a href="https://docs.godotengine.org/en/stable/classes/class_planemesh.html">PlaneMesh</a> statt des von uns generierten Gitters nutzt. Zudem wollen wir Die Normalen des Meshes berechnen, um die Beleuchtung des Geländes zu ermöglichen.</p>
<blockquote class="todo">
    Baue das Script vom letzten mal so um, dass es Godots <a href="https://docs.godotengine.org/en/stable/classes/class_planemesh.html"><strong>PlaneMesh</strong></a> und das <a href="https://docs.godotengine.org/en/stable/tutorials/3d/procedural_geometry/surfacetool.html"><strong>SurfaceTool</strong></a> nutzt um das Mesh + Normalen zu generieren
</blockquote>
<h2 id="22-terrain-falloff">2.2 Terrain Falloff</h2>
<p>Für die meisten Anwendungsfälle ist es nützlicher, wenn unser Terrain zu den Kanten hin langsam abflacht anstatt einfach aufzuhören:</p>
<p><img src="img/falloff.png" alt="terrain falloff"></p>
<p>Wir benötigen daher nun eine Funktion, um den Einfluss der Deformation abhängig von der Entfernung zum Rand zu kontrollieren.</p>
<blockquote class="todo">
    <ul>
<li>Schreibe eine Funktion, die anhand der x und z Koordinaten einen Wert zwischen 0 und 1 ausgibt. Je weiter näher der Punkt am Rand des Geländes ist, desto niedriger soll dieser Wert sein.</li>
<li>Nutze diese Funktion, um den Einfluss der Deformation zu kontrollieren.</li>
</ul>
<p><strong>Tipps:</strong></p>
<ul>
<li>in der Mitte des Terrains gilt x=0, y=0</li>
<li><img src="img/sincos.png" alt="sin, cos"></li>
</ul>
</blockquote>
<h2 id="23-fbm-und-perlin">2.3 FBM und Perlin</h2>
<p>Eine der wichtigsten prozeduralen Texturen in der Computergrafik ist das sogenannte Perlin Noise. Wir nutzen es zum Beispiel, um eine Landschaft zu generieren. Benannt wurde diese Technik nach dem Erfinder Ken Perlin, der für diese für den Film &ldquo;Tron&rdquo; entwickelte und einen Oscar gewann. Zwar gibt es in den meisten Umgebungen schon vorgegebene Funktionalität für Noise, es kann jedoch nicht schaden zu wissen, wie es grob funktioniert. Hier wird daher konzeptionell eine Vereinfachte Variante der Funktion erklärt.</p>
<h3 id="random">Random</h3>
<p>Die Generierung von zufälligen Zahlen ist mit Computern nicht so einfach, wie es erscheinen mag. Meist werden dabei Algorithmen verwendet, die für einen bestimmten Startwert (Seed) eine pseudozufällige Zahl zurückgeben. Die im <a href="https://thebookofshaders.com/"><em>Book od Shaders</em></a> definierte Funktion ist:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">fract</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">);</span>
</span></span></code></pre></div><p><img src="img/7.png" alt="">
<em>The Book of Shaders: Random (thebookofshaders.com/10/)</em></p>
<p>klein genug skaliert und auf das Skalarprodukt eines Inputvektorsangewandt und eines zweiten fest definierten Vektors folgt daraus ein homogenes Rauschen, wenn es z.b. wie hier direkt auf die Texturkoordinaten angewandt wird.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">// 2D Random</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">float</span> <span class="n">random</span> <span class="p">(</span><span class="k">in</span> <span class="k">vec2</span> <span class="n">st</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="k">return</span> <span class="n">fract</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">st</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">        <span class="k">vec2</span><span class="p">(</span><span class="mf">12.9898</span><span class="p">,</span><span class="mf">78.233</span><span class="p">)))</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">            <span class="o">*</span> <span class="mf">43758.5453123</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><img src="img/8.png" alt=""></p>
<h3 id="noise">Noise</h3>
<p>Um mithilfe dieser <code>Random</code> Funktion nun ein gleichmäsigeres Rauschen zu erzeugen, wird zunächst ein vec2 <code>i</code> erzeugt, der die Texturkoordinaten auf die darunterliegente ganzzahligen Integer rundet. Für daraus erbibt sich dann ein Gitter, welches Zellen je nach Skalierung der Textur besitzt und für jede Zelle einen X und Y Wert von 0-Skalierung definiert.</p>
<p><em>Beispiel für Skalierung = 3</em></p>
<p><img src="img/table.png" alt=""></p>
<p>Diese Werte werden dann verwendet, um einen zufälligen Wert pro Zelle zu generieren.</p>
<p><img src="img/9a.png" alt=""></p>
<p>Das wird nun noch drei mal wiederholt, wobei die Koordinaten jeweils um 1 nach rechts, nach unten und nach rechts unten versetzt werden. Daraus ergeben sich die Bilder a,b,c und d.
<img src="img/abcdImg.png" alt=""><br>
Schließlich wird der Restwert von i (<code>fract</code>) ermittelt und mithilfe einer sogenannten quintic interpolation curve weicher dargestellt.<br>
<img src="img/10.png" alt=""><br>
Mit diesem Wert werden die vier Texturen dann prozentual gemischt, um einen Übergang zwischen den vier Texturen zu erzeugen.<br>
<img src="img/11.png" alt=""></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// Aus Book Of Shaders -</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1">// 2D Noise based on Morgan McGuire @morgan3d</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1">// https://www.shadertoy.com/view/4dS3Wd</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">float</span> <span class="n">noise</span><span class="p">(</span><span class="k">in</span> <span class="k">vec2</span> <span class="n">st</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">vec2</span> <span class="n">i</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">st</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="c1">// 4 Ecken erzeugen</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">float</span> <span class="n">a</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">float</span> <span class="n">b</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">vec2</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fract</span><span class="p">(</span><span class="n">st</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="c1">//quintic interpolation curve</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">u</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="mf">6.</span><span class="o">-</span><span class="mf">15.</span><span class="p">)</span><span class="o">+</span><span class="mf">10.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="c1">// 4 Ecken prozentual mischen</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">return</span> <span class="n">mix</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">u</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span><span class="o">*</span> <span class="n">u</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">u</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">u</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="iterationen">Iterationen</h3>
<p>Mehrere Ergebnisse der oben beschriebenen Funktion, können nun übereinandergelegt werden um ein detailierteres Ergebnis zu erzielen. Dabei wird mit jeder weiteren sogen. Oktave die Skalierung erhöht (Textur verkleinert) und mit einem immer niedriger werdenden Wert (amplitude) zum bisherigen Ergebnis hinzugefügt.
Dieser iterative Prozess wird Fractal Brownian Motion - fbm Noise genannt.</p>
<p><img src="img/12.png" alt=""></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">fbm</span><span class="p">(</span><span class="k">in</span> <span class="k">vec2</span> <span class="n">st</span><span class="p">,</span> <span class="k">int</span> <span class="n">OCTAVES</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">float</span> <span class="n">value</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">float</span> <span class="n">amplitude</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="c1">// Loop octaves</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">OCTAVES</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="n">value</span> <span class="o">+=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">noise</span><span class="p">(</span><span class="n">st</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="n">st</span> <span class="o">*=</span> <span class="mf">2.</span><span class="p">;</span>           <span class="c1">//Skalierung erhöhen</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="n">amplitude</span> <span class="o">*=</span> <span class="mf">.5</span><span class="p">;</span>    <span class="c1">//Amplitude verringern</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">return</span> <span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="24-terrain-shading">2.4 Terrain Shading</h2>
<p>Wenn wir die Landschaft schon komplett im Code generieren, haben wir natürlich auch gar keine Lust, sie von Hand anzumalen. Wir brauchen daher noch eine Möglichkeit zu Texturierung des Meshes. Wir wollen zunächst eine verschneite Landschaft generieren und müssen daher nun eine Maske generieren, die zwischen Schnee und Fels mischen kann.</p>
<p><img src="img/matterhorn.jpg" alt="matterhorn"></p>
<blockquote class="todo">
    Überlege dir, anhand welcher Parameter so eine Unterscheidung stattfinden könnte und finde heraus, wie in Godot automatische Texturierung stattfinden könnte.
</blockquote>


			<aside class="copyright" role="note">
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://simonstorlschulke.github.io/cg-mib-2/general/" title="Allgemeines">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Allgemeines
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://simonstorlschulke.github.io/cg-mib-2/chapter01/exercise01_a/" title="1. Datenstrukturen in 3D &amp; Godot Basics">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              1. Datenstrukturen in 3D &amp; Godot Basics
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="https://simonstorlschulke.github.io/cg-mib-2/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>


